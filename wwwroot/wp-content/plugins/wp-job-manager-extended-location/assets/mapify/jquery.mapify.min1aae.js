!function(v){v.fn.extend({mapify:function(t){var k=v.extend({height:"200px",lat:0,lng:0,lock:"unlock",lat_input:"mapify_lat",lng_input:"mapify_lng",lock_input:"mapify_lock"},t),f=v(this);return this.each(function(){f.wrap('<div class="mapify"><span class="geo-tag"></span></div>');var e=f.parents(".mapify"),o=f.parent(".geo-tag");e.data("lock_status",k.lock),v("#"+k.id).length||e.append('<div class="map-canvas" style="width:100%;height:'+k.height+';"></div>');var t="unlock"==k.lock?mapifyl10n.locked:mapifyl10n.unlocked,a="unlock"==k.lock?"unlocked":"locked";e.append('<div class="map-canvas-options"><span class="map-action-lock '+a+'" data-lock_status="'+k.lock+'" data-lock="'+mapifyl10n.locked+'" data-unlock="'+mapifyl10n.unlocked+'">'+t+"</span></div>"),e.append('<input autocomplete="off" type="hidden" name="'+k.lock_input+'" value="'+k.lock+'">'),e.append('<input autocomplete="off" type="hidden" name="'+k.lat_input+'" value="'+k.lat+'">'),e.append('<input autocomplete="off" type="hidden" name="'+k.lng_input+'" value="'+k.lng+'">');var n,l,i,s,d,c=f,p=e.find(".map-canvas"),u=e.find('input[name="'+k.lock_input+'"]'),g=e.find('input[name="'+k.lat_input+'"]'),r=e.find('input[name="'+k.lng_input+'"]'),m={init:function(){""==c.val()||k.lat||k.lng||m.SetCoordinate(),m.loadMap(),m.loadAddressAutoComplete(),m.geoTag(),m.toggleLock()},loadMap:function(){s=new google.maps.Geocoder,i=new google.maps.LatLng(k.lat,k.lng),n=new google.maps.Map(p[0],{center:i,zoom:13,streetViewControl:!1});var t="unlock"==e.data("lock_status");l=new google.maps.Marker({map:n,draggable:t,animation:google.maps.Animation.DROP,anchorPoint:new google.maps.Point(0,-29),position:i}),google.maps.event.addListener(l,"dragend",function(t){var a,o;"unlock"==e.data("lock_status")&&(o=(a=t.latLng).lat(),t=a.lng(),m.updatePosition(o,t,a),m.updateAddress(a))}),google.maps.event.addDomListener(window,"resize",function(){var t=n.getCenter();google.maps.event.trigger(n,"resize"),n.setCenter(t)}),e.on("mapify_resize",function(){var t=n.getCenter();google.maps.event.trigger(n,"resize"),n.setCenter(t)})},SetCoordinate:function(){(s=new google.maps.Geocoder).geocode({address:c.val()},function(t){var a,o=t[0].geometry.location;null!=o&&(a=o.lat(),t=o.lng(),g.val(a),r.val(t),m.updatePosition(a,t,o),l.setPosition(o))})},geoTag:function(){if(navigator.geolocation){var t=/chrom(e|ium)/.test(navigator.userAgent.toLowerCase()),a="https:"==document.location.protocol;if(t&&!a)return!1;o.prepend('<i class="location"></i>'),o.children(".location").click(function(t){t.preventDefault();var e=v(this);e.addClass("loading"),navigator.geolocation.getCurrentPosition(function(t){var a=t.coords.latitude,o=t.coords.longitude,t=new google.maps.LatLng(a,o);m.updatePosition(a,o,t),l.setPosition(t),m.updateAddress(t),e.removeClass("loading")},function(){e.removeClass("loading")})})}},loadAddressAutoComplete:function(){(d=new google.maps.places.Autocomplete(c[0])).bindTo("bounds",n),google.maps.event.addListener(d,"place_changed",function(){var t,a,o;"unlock"!=e.data("lock_status")||void 0!==(o=d.getPlace())&&(a=(t=o.geometry.location).lat(),o=t.lng(),m.updatePosition(a,o,t),l.setPosition(t))}),google.maps.event.addDomListener(c[0],"keydown",function(t){13==t.keyCode&&(t.preventDefault(),m.SetCoordinate(),v(".pac-container").hide())})},toggleLock:function(){e.find(".map-action-lock").click(function(t){t.preventDefault();t=v(this).data("lock_status");t=("unlock"==t?(l.setDraggable(!1),v(this).removeClass("locked unlocked").addClass("locked"),v(this).text(v(this).data("unlock")),v(this).data("lock_status","lock")):(l.setDraggable(!0),v(this).removeClass("locked unlocked").addClass("unlocked"),v(this).text(v(this).data("lock")),v(this).data("lock_status","unlock")),v(this).data("lock_status")),v(this).attr("data-lock_status",t),e.data("lock_status",t),u.val(t)})},updatePosition:function(t,a,o){g.val(t),r.val(a),n.panTo(o)},updateAddress:function(t){s.geocode({latLng:t},function(t,a){a==google.maps.GeocoderStatus.OK&&t[0]&&c.val(t[0].formatted_address)})}};m.init()})}})}(jQuery);