function gjm_calculate_distance(e,o,t,i){var n=.017453292519943295,a=Math.cos,s=.5-a((t-e)*n)/2+a(e*n)*a(t*n)*(1-a((i-o)*n))/2;return 12742*Math.asin(Math.sqrt(s))}var GJM_Maps={},GJM_Map=function(e,o){this.id=e,this.prefix=o,this.map_element=o+"-map-"+e,this.main_container=jQuery('.gjm-enabled[data-id="'+e+'"]').closest("div.resumes, div.job_listings"),this.map=!1,this.map_options={},this.map_type="ROADMAP",this.locations=[],this.previous_locations=[],this.markers=[],this.active_info_window=!1,this.user_data=!1,this.user_position=!1,this.user_map_icon="https://maps.google.com/mapfiles/ms/icons/blue-dot.png",this.user_info_window=!1,this.grouping_type="normal",this.info_window_type="info_bubble",this.user_marker=!1,this.clusters=!1,this.spiderfiers=!1,this.bounds=!1,this.active_marker=null,this.clusters_path="https://raw.githubusercontent.com/googlemaps/js-marker-clusterer/gh-pages/images/m",this.polylines=[],this.resize_map_control=!1,this.auto_zoom_level=!1,this.zoom_position=!1,this.init=function(e){var o=this;0==o.map?jQuery("#"+o.prefix+"-map-wrapper-"+o.id).slideDown("fast",function(){o.render_map(e)}):o.update_map(e.locations,e.user_position)}};GJM_Map.prototype.render_map=function(e){var o=this;if(jQuery("#"+o.map_element).length){o.locations=e.locations,o.user_data=e.user_position,o.bounds=new google.maps.LatLngBounds,o.orgArgs=e.args,o.zoom_position=e.args.zoom_position;var t=jQuery("#"+o.map_element).data();o.clusters_path=t.clusters_path,o.grouping_type=t.group_markers,o.user_map_icon=t.user_marker,o.map_options=e.map_options,o.map_options.mapTypeId=t.map_type,o.map_options.scrollwheel=t.scrollwheel,o.map_options.maxZoom=t.max_zoom_level,o.map_options.zoomLevel=t.zoom_level,"auto"==o.map_options.zoomLevel?(o.auto_zoom_level=!0,o.map_options.zoomLevel=13):(o.auto_zoom_level=!1,o.map_options.zoomLevel=parseInt(o.map_options.zoomLevel)),o.map_options.center=new google.maps.LatLng("40.758895","-73.985131"),o.map_options.mapTypeId=google.maps.MapTypeId[o.map_options.mapTypeId],o.map=new google.maps.Map(document.getElementById(o.map_element),o.map_options),google.maps.event.addListenerOnce(o.map,"idle",function(){jQuery("#"+o.prefix+"-map-loader-"+o.id).fadeOut(1e3),o.map_options.resizeMapControl&&0!=jQuery("#"+o.prefix+"-resize-map-toggle-"+o.id).length&&(o.resize_map_control=document.getElementById(o.prefix+"-resize-map-toggle-"+o.id),o.resize_map_control.style.position="absolute",o.map.controls[google.maps.ControlPosition.TOP_RIGHT].push(o.resize_map_control),o.resize_map_control.style.display="block",jQuery("#"+o.prefix+"-resize-map-toggle-"+o.id).on("click",function(){var e=o.map.getCenter();jQuery(this).closest("."+o.prefix+"-map-wrapper").toggleClass("gjm-expanded-map"),jQuery(this).toggleClass("gjm-icon-resize-full").toggleClass("gjm-icon-resize-small"),setTimeout(function(){google.maps.event.trigger(o.map,"resize"),o.map.setCenter(e)},100)}),google.maps.event.addListener(o.map,"click",function(e){o.close_info_window()}),google.maps.event.addDomListener(o.map,"zoom_changed",function(e){o.close_info_window()})),o.clear_markers(),o.remove_user_marker(),o.generate_user_marker(),o.generate_markers()})}},GJM_Map.prototype.clear_markers=function(){for(var e=this,o=0;o<e.markers.length+1;o++)o<e.markers.length?e.markers[o]&&e.markers[o].setMap(null):(this.clear_polylines(),e.markers=[],this.group_markers())},GJM_Map.prototype.clear_polylines=function(){for(var e=0;e<this.polylines.length+1;e++)e<this.polylines.length?this.polylines[e].setMap(null):this.polylines=[]},GJM_Map.prototype.group_markers=function(){var e="grouping_type_"+this.grouping_type;"function"==typeof this[e]?this[e]():console.log("The function "+e+" not exists.")},GJM_Map.prototype.grouping_type_normal=function(){},GJM_Map.prototype.grouping_type_markers_clusterer=function(){"function"==typeof MarkerClusterer&&(0!=this.clusters&&this.clusters.clearMarkers(),this.clusters=new MarkerClusterer(this.map,this.markers,{imagePath:this.clusters_path,clusterClass:this.prefix+"-cluster cluster",maxZoom:15}))},GJM_Map.prototype.grouping_type_markers_spiderfier=function(){var e=this;"function"==typeof OverlappingMarkerSpiderfier&&(e.spiderfiers=new OverlappingMarkerSpiderfier(e.map,{legWeight:2,markersWontMove:!0,markersWontHide:!0,basicFormatEvents:!0,keepSpiderfied:!0}),e.spiderfiers.addListener("spiderfy",function(o){e.close_info_window()}))},GJM_Map.prototype.move_marker=function(){var e=360/this.locations.length,o=this.locations[i].marker_position.lat()+-25e-6*Math.cos(+e*i/180*Math.PI),t=this.locations[i].marker_position.lng()+-25e-6*Math.sin(+e*i/180*Math.PI),n=new google.maps.LatLng(o,t);return this.polylines.push(new google.maps.Polyline({path:[this.locations[i].marker_position,n],strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:2,map:this.map})),n},GJM_Map.prototype.update_map=function(e,o){var t=this;jQuery("#"+t.map_element).length&&(t.locations=e,t.user_data=o,t.bounds=new google.maps.LatLngBounds,t.close_info_window(),jQuery("#"+t.prefix+"-map-wrapper-"+t.id).slideDown("fast",function(){t.clear_markers(),t.remove_user_marker(),t.generate_user_marker(),t.generate_markers()}))},GJM_Map.prototype.generate_user_marker=function(){var e=this;0!=e.user_data.lat&&0!=e.user_data.lng&&"0"!=e.user_map_icon&&""!=e.user_map_icon&&(e.user_position=new google.maps.LatLng(e.user_data.lat,e.user_data.lng),e.bounds.extend(e.user_position),e.user_marker=new google.maps.Marker({position:e.user_position,map:e.map,icon:e.user_map_icon}),0!=e.user_data.iw_content&&null!=e.user_data.iw_content&&(e.user_marker.iwContent='<span class="title">'+e.user_data.iw_content+"</span>",google.maps.event.addListener(e.user_marker,"click",function(){e.marker_click_info_bubble(e.user_marker)})))},GJM_Map.prototype.get_previous_locations=function(){var e=this;if(0==e.main_container.data("show_pagination")){if(e.main_container.find(".indeed-enabled").length){var o=[];jQuery.each(e.previous_locations,function(e,t){"undefined"!=typeof t.post_id&&(o[e]=t)}),e.previous_locations=o}0==e.previous_locations?e.previous_locations=e.locations:e.main_container.data("append_results")?(temLoc=jQuery.merge(e.locations,e.previous_locations),e.previous_locations=e.locations,e.locations=temLoc):e.previous_locations=e.locations}},GJM_Map.prototype.generate_markers=function(){var e=this;e.get_previous_locations();var o=e.locations.length;for(i=0;i<o+1;i++)if(i<o){if(void 0==e.locations[i].lat||void 0==e.locations[i].lng||"0.000000"==e.locations[i].lat||"0.000000"==e.locations[i].lng)continue;e.locations[i].marker_position=new google.maps.LatLng(e.locations[i].lat,e.locations[i].lng),"markers_spiderfier"!=e.grouping_type&&e.bounds.contains(e.locations[i].marker_position)&&(e.locations[i].marker_position=e.move_marker()),e.bounds.extend(e.locations[i].marker_position);var t={position:e.locations[i].marker_position,icon:e.locations[i].map_icon,map:e.map,locId:i,iwContent:e.locations[i].info_window_content};e.markers[i]=new google.maps.Marker(t),"markers_clusterer"==e.grouping_type&&"function"==typeof MarkerClusterer?(e.clusters.addMarker(e.markers[i]),google.maps.event.addListener(e.markers[i],"click",function(){e.marker_click(this)})):"markers_spiderfier"==e.grouping_type&&"function"==typeof OverlappingMarkerSpiderfier?(e.spiderfiers.addMarker(e.markers[i]),e.markers[i].setMap(e.map),google.maps.event.addListener(e.markers[i],"spider_click",function(){e.marker_click(this)})):(e.markers[i].setMap(e.map),google.maps.event.addListener(e.markers[i],"click",function(){e.marker_click(this)}))}else e.center_map()},GJM_Map.prototype.remove_user_marker=function(){0!=this.user_marker&&(this.user_marker.setMap(null),this.user_marker=!1,this.user_position=!1)},GJM_Map.prototype.center_map=function(){var e=this;if(0==e.zoom_position||e.auto_zoom_level)1==e.locations.length&&0==e.user_position?(e.auto_zoom_level?e.map.setZoom(13):e.map.setZoom(parseInt(e.map_options.zoomLevel)),e.map.panTo(e.markers[0].getPosition())):e.auto_zoom_level||0==e.user_position?(e.auto_zoom_level||0==e.user_position)&&e.map.fitBounds(e.bounds):(e.map.setZoom(parseInt(e.map_options.zoomLevel)),e.map.panTo(e.user_position));else{var o=new google.maps.LatLng(e.zoom_position[0],e.zoom_position[1]);e.map.setZoom(parseInt(e.map_options.zoomLevel)),e.map.panTo(o)}},GJM_Map.prototype.marker_click=function(e){this.acvtive_marker=e,"undefined"!=typeof directionsDisplay&&directionsDisplay.setMap(null);var o="marker_click_"+this.info_window_type;"function"==typeof this[o]?this[o](e):console.log("The function "+o+" not exists.")},GJM_Map.prototype.close_info_window=function(){this.active_info_window&&(this.active_info_window.close(),this.active_info_window=!1)},GJM_Map.prototype.marker_click_normal=function(e){e.iwContent&&(this.close_info_window(),this.active_info_window=new google.maps.InfoWindow({content:e.iwContent,maxWidth:300}),this.active_info_window.open(this.map,e))},GJM_Map.prototype.marker_click_info_bubble=function(e){this.close_info_window(),e.iwContent&&(this.active_info_window=new InfoBubble({content:e.iwContent,shadowStyle:0,padding:15,borderRadius:5,borderWidth:0,borderColor:"#ffffff",backgroundColor:"#ffffff",minWidth:"250px",maxWidth:"350px",minHeight:"80px",arrowSize:20,arrowPosition:50,arrowStyle:0,disableAutoPan:!1,hideCloseButton:!1,closeSrc:" ",backgroundClassName:this.prefix+"-info-window bubble gjm-icon-cancel-circled"}),this.active_info_window.open(this.map,e))},jQuery(document).ready(function(e){function o(o){return t()?e(document.body).hasClass("disable-job-manager-form-state-storage")?!1:o.data("disable-form-state-storage")?!1:!0:!1}function t(){return window.sessionStorage&&"function"==typeof window.sessionStorage.setItem}function n(o){var t=e("div.job_listings").index(o),i=o.data("post_id");return"undefined"!=typeof i&&i||(i=window.location.href.replace(location.hash,"")),r+i+"_"+t}function a(e){if(!o(e))return!1;var t=n(e);try{var i=window.sessionStorage.getItem(t);if(i)return JSON.parse(i)}catch(a){}return!1}function s(e){if("undefined"!=typeof e){var o=e.args.map_id,t=e.args.prefix;"undefined"==typeof GJM_Maps[o]?(GJM_Maps[o]=new GJM_Map(o,t),GJM_Maps[o].init(e),e={}):(GJM_Maps[o].update_map(e.locations,e.user_position),e=!1)}}var r="job_listing_";e(".job_listings, .resumes").on("update_results",function(e,o,t){0==jQuery(this).data("show_pagination")?jQuery(this).data("append_results",t):jQuery(this).data("append_results",!1)}),e(window).on("load",function(){e("div.gjm-enabled").each(function(){var o=e(this).closest(".job_listings"),t=o.find(".job_filters"),i=a(o),n=jQuery(this).data("id");if(i){var r=new URLSearchParams(i.results.data.form_data);if(r.has("radius")&&t.find("#gjm-radius").val(r.get("radius")).trigger("change"),r.has("gjm_units")&&t.find("#gjm-units").val(r.get("gjm_units")).trigger("change"),r.has("gjm_orderby")&&t.find("#gjm-orderby").val(r.get("gjm_orderby")).trigger("change"),i.results&&"undefined"!=typeof i.results.gjm_map&&jQuery(document).find("#gjm-map-"+n).length){var p=i.results,l="undefined"!=typeof p.gjm_map?p.gjm_map:!1;p.data.form_data+="&gjm_element_id="+n,p.gjm_map.args.map_id=n,s(l)}}})}),jQuery(".job_listings, .resumes").on("updated_results",function(e,o){var t="undefined"!=typeof o.gjm_map?o.gjm_map:!1;if(0!=t){var n=jQuery(e.currentTarget),a=n.find(".gjm-enabled").data("id"),r=n.find(".gjm-enabled").data("prefix"),p="default";if(jQuery("body").is('[class*=" jobify"]')&&(p="jobify"),e.target.className.indexOf("job_listings")>=0&&1==o.found_jobs||"resumes"==e.target.className&&1==o.found_resumes)if(n.find(".indeed-enabled").length&&n.find(".wp-job-manager-attribution-row.job_listing").length){var l=!1,_=!1,m=jQuery("#"+r+"-map-"+a).length?!0:!1;if("undefined"==typeof t||0==t){l=n.find(".gjm-lat").val(),_=n.find(".gjm-lng").val();var c={lat:!1,lng:!1};"undefined"!=l&&"undefined"!=_&&(c={lat:l,lng:_,iw_content:"You are here",iw_open:!1}),t={args:{},map_options:{},locations:[],user_position:c}}var d=n.find("#"+r+"-orderby").val(),u="imperial"==n.find("#"+r+"-units").val()?"mi":"km",g=(n.find("#"+r+"-radius").val(),n.find("#search_location").val()),f=n.find(".indeed-enabled").data("distance"),h=n.find(".indeed-enabled").data("map_icon"),w=n.find(".wp-job-manager-attribution-row.job_listing"),y=w.length,v=0;w.each(function(){var e=jQuery(this),o=jQuery(this).next(".job_listing").nextUntil(".type-job_listing, .wp-job-manager-attribution-row").addBack(),n=o.length;for(i=0;i<n+1;i++)if(i<n){var a=jQuery(o[i]),l=a.data(),_=l.latitude,c=l.longitude,w=!1,k=25==_&&-40==c?!0:!1;k||"undefined"==g||(0!=t.user_position.lat&&0!=t.user_position.lng&&(w=gjm_calculate_distance(t.user_position.lat,t.user_position.lng,_,c),"mi"!=u&&(w=1.609344*w),w=w.toFixed(1),a.attr("data-distance",w),1==f&&(a.find("."+r+"-distance-wrapper").length?a.find("."+r+"-distance-wrapper").html(w+" "+u):a.find("ul.meta, ul.job_listing-meta").append('<span class="'+r+'-distance-wrapper">'+w+" "+u+"</span>"))),m&&(info_window_content="","jobify"==p?(info_window_content+='<a class="title" target="_blank" href="'+l.href+'">'+l.title+"</a>",info_window_content+='<span class="location gjm-icon-location">'+a.find(".job_listing-about .job_listing-location").html()+"</span>"):(info_window_content+='<a class="title" target="_blank" href="'+a.find("a").attr("href")+'">'+a.find(".position h3").html()+"</a>",info_window_content+='<span class="location gjm-icon-location">'+a.find(".location").html()+"</span>"),1==f&&0!=w&&(info_window_content+='<span class="distance">'+w+" "+u+"</span>"),t.locations.push({lat:_,lng:c,map_icon:h,info_window_content:info_window_content})))}else"distance"==d&&0!=w&&o.sort(function(e,o){return+e.dataset.distance-+o.dataset.distance}).insertAfter(e),v++,v==y&&s(t)})}else s(t);else"undefined"!=typeof GJM_Maps[a]&&(GJM_Maps[a].clear_markers(),jQuery("#gjm-map-wrapper-"+a).length&&1!=jQuery("#gjm-map-"+a).data("show_without_locations")&&jQuery("#gjm-map-wrapper-"+a).slideUp());t=!1}})}),jQuery(document).ready(function(e){"undefined"!=typeof gjmMapObjects&&jQuery.each(gjmMapObjects,function(e,o){GJM_Maps[e]=new GJM_Map(e,o.args.prefix),GJM_Maps[e].render_map(o)})});